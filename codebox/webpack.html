<!DOCTYPE html>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A Guide to Webpack">

	<title>Codebox - Webpack</title>

	<link rel="shortcut icon" type="image/ico" href="favicon/code.ico">
	<link rel="stylesheet" href="style/foundation.min.css">
	<link rel="stylesheet" href="style/main.css">
</head>
<body>

<main role="main">
	<div class="row">
		<div class="columns small-12 large-12">

			<h1>Webpack</h1>

            <p>Webpack is an open-source module bundler. Its main purpose is to bundle JavaScript files for use in the browser. As a module bundler, Webpack packs all your code as bundles for the browser and allows you to write the latest, modern JavaScript with Babel or using TypeScript. This can then be compiled into code that is cross-browser compatible and minified.</p>

            <p>Both the <strong>vue create</strong> and <strong>create-react-app</strong> tools rely on Webpack under the hood.</p>

            <p>Webpack has four main concepts that need to be understood:</p>

            <ul>
                <li><strong>Entry</strong> - the entry point is the module which Webpack uses to start building its internal dependency graph. By default the entry property is set to <strong>index.js</strong>, but we can specify a different module (or multiple modules) in the Webpack configuration file - <strong>webpack.config.js</strong></li>
                <li><strong>Output</strong> - the output property provides Webpack the location of where to emit the bundle(s) and what name(s) to use for the file(s). The default value for this property is <strong>main.js</strong> for the main bundle and all bundles are emitted into a <strong>dist</strong> directory. Alternative values can be specified within a <strong>webpack.config.js</strong> config file.</li>
                <li><strong>Loaders</strong> - By default, Webpack only understands JavaScript and JSON (JavaScript Object Notation) files. To process other types of file, Webpack uses Loaders. These transform the source code of non-JavaScript modules allowing us to preprocess these files before they're added to the dependency graph.</li>
                <li><strong>Plugins</strong> - used for any other tasks that loaders cannot do. Plugins provide us with a wide range of solutions including minimisation and optimisation of our code.</li>
            </ul>

            <p>By default and without a <strong>webpack.config.js</strong> file, Webpack will search for a src directory containing a file named <strong>index.js</strong> in your project. Once the build has completed, a <strong>dist</strong> directory will be created with a generated <strong>main.js</strong> bundled file within. This will be minified as Webpack runs in production mode by default.</p>

            <h2>Install Webpack</h2>

            <p>Using NPM (Node Package Manager), Webpack can be installed. Both the <strong>webpack</strong> and <strong>webpack-cli</strong> packages need to be installed. Open your terminal and install both packages as devDependencies.</p>

<!-- Terminal -->
<div class="terminal terminal--shadow">
    <div class="terminal__top">
        <div class="terminal__buttons">
            <span class="terminal__circle terminal__circle--red"></span>
            <span class="terminal__circle terminal__circle--yellow"></span>
            <span class="terminal__circle terminal__circle--green"></span>
        </div>
        <div class="terminal__title">bash -- 85x24</div>
    </div>
    <pre class="terminal__body">
<!-- Just leave this line alone -->
    $ npm install webpack webpack-cli --save-dev
    </pre>
</div>
<!-- / Terminal -->

            <ul>
                <li><strong>webpack</strong> - the module and asset bundler.</li>
                <li><strong>webpack-cli</strong> - the command-line interface for Webpack.</li>
            </ul>

            <p>Open your <strong>package.json</strong> file and create a script to run Webpack.</p>

<pre>
    <code>
<!-- Just leave this line alone -->
"scripts": {
    "build": "webpack"
} 
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>Open your terminal and run Webpack.</p>

<!-- Terminal -->
<div class="terminal terminal--shadow">
    <div class="terminal__top">
        <div class="terminal__buttons">
            <span class="terminal__circle terminal__circle--red"></span>
            <span class="terminal__circle terminal__circle--yellow"></span>
            <span class="terminal__circle terminal__circle--green"></span>
        </div>
        <div class="terminal__title">bash -- 85x24</div>
    </div>
    <pre class="terminal__body">
<!-- Just leave this line alone -->
    $ npm run build
    </pre>
</div>
<!-- / Terminal -->

            <p>When you run Webpack for the first time you may encounter an error. The default behavior of Webpack is to search for a file named <strong>index.js</strong> within a <strong>src</strong> directory inside your project. Webpack will return an error in the terminal if this directory and/or file cannot be found. Your file structure should look something like this:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
node_modules
.gitignore
package-lock.json
package.json
src /
    index.js
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>The <strong>.gitignore</strong> and <strong>node_modules</strong> file and directory have been added to demonstrate the likely file structure. The <strong>index.js</strong> file can be a very simple example file to get Webpack running.</p>

<pre>
    <code>
<!-- Just leave this line alone -->
// src/index.js

console.log('Hello World');
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>Webpack will generate a <strong>dist</strong> directory if the build is successful and a bundled <strong>main.js</strong> file will be created. Your file structure will then be updated.</p>

<pre>
    <code>
<!-- Just leave this line alone -->
node_modules
dist /
    main.js
.gitignore
package-lock.json
package.json
src /
    index.js
<!-- Just leave this line alone -->
    </code>
</pre>

            <h2>Setting the Mode</h2>

            <p>Webpack introduces the concept of <strong>Mode</strong>. Typically when we develop an application we work with two types of source code, one for development the other for production. Webpack allows us to set which one we want to generate by changing the mode parameter. This parameter can either be <strong>production</strong>, <strong>development</strong> or <strong>none</strong>. This allows Webpack to use built-in optimisation that corresponds to each environment.</p>

            <p>By default, Webpack will always use the production mode. The bundle created will be minified and optimised for production.</p>

            <p>Open the <strong>package.json</strong> file and update the scripts to set the production and development modes:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
"scripts": {
    "build": "webpack --mode production",
    "build:dev": "webpack --mode development"
} 
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>We can now use either build script to run Webpack in production or development modes.</p>

<!-- Terminal -->
<div class="terminal terminal--shadow">
    <div class="terminal__top">
        <div class="terminal__buttons">
            <span class="terminal__circle terminal__circle--red"></span>
            <span class="terminal__circle terminal__circle--yellow"></span>
            <span class="terminal__circle terminal__circle--green"></span>
        </div>
        <div class="terminal__title">bash -- 85x24</div>
    </div>
    <pre class="terminal__body">
<!-- Just leave this line alone -->
    # Production mode
    $ npm run build

    # Development mode
    $ npm run build:dev
    </pre>
</div>
<!-- / Terminal -->

            <h2>Config file</h2>

            <p>Although Webpack is considered as <strong>'zero-configuration'</strong>, a config file can be added to further extend the functionality of Webpack. This config file sits in the root of your project and is named <strong>webpack.config.js</strong>.</p>

<pre>
    <code>
<!-- Just leave this line alone -->
node_modules
dist /
    main.js
.gitignore
package-lock.json
package.json
src /
    index.js
webpack.config.js
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>The first part of setting up a Webpack config file is defining the <strong>entry point</strong>, what file or files Webpack will look for to compile and where to find them. In our example, we set the entry point to be <strong>src/index.js</strong>. Open the <strong>webpack.config.js</strong> file and add the following code:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
const path = require('path')

module.exports = {
    entry: {
        main: path.resolve(__dirname, './src/index.js')
    }
}
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>The <strong>output</strong> is where the bundled file will resolve. By default the output is the <strong>dist</strong> folder which is where our code gets built. The <strong>[name]</strong> in the output will be <strong>main</strong>, as specified in the entry object.</p>

<pre>
    <code>
<!-- Just leave this line alone -->
const path = require('path')

module.exports = {
    entry: {
        main: path.resolve(__dirname, './src/index.js')
    },
    output: {
        path: path.resolve(__dirname, './dist'),
        filename: '[name].bundle.js'
    }
}
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>You can see that when we run our build, Webpack will generate a bundled file named <strong>main.bundle.js</strong> and this will be output in the <strong>dist</strong> folder.</p>

            <p>We can change the name of the bundle if the production or development mode is used from within the output. Begin by importing an <strong>environment variable</strong> on line one of the <strong>webpack.config.js</strong> file. Next, add a ternary into the filename property inside output. The code below shows these two updates:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
const env = process.env.NODE_ENV
const path = require('path')

module.exports = {
    entry: {
        main: path.resolve(__dirname, './src/index.js')
    },
    output: {
        path: path.resolve(__dirname, './dist'),
        filename: env === 'production' ? '[name].bundle.min.js' : '[name].bundle.js'
    }
}
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>Now update your <strong>package.json</strong> file to pass in the values of <strong>'production'</strong> or <strong>'development'</strong> when a build script is run.</p>

<pre>
    <code>
<!-- Just leave this line alone -->
"scripts": {
    "build": "NODE_ENV=production webpack --mode=production",
    "build:dev": "NODE_ENV=development webpack --mode=development",
} 
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>When the production build script is run, the value of <strong>'production'</strong> is passed to the <strong>NODE_ENV</strong> environment variable and this in-turn is passed into the <strong>webpack.config.js</strong>. This will output a minified bundle with the filename of <strong>main.bundle.min.js</strong>.</p>

            <p>If the development mode is run, the value of <strong>'development'</strong> is passed to the <strong>NODE_ENV</strong> variable and into the <strong>webpack.config.js</strong> file which then outputs the bundle name of <strong>main.bundle.js</strong> using the 'else' part of the ternary in the filename property.</p>

            <p>You may want to add a progress flag to each build script to see progress in the terminal as your build runs.</p>

<pre>
    <code>
<!-- Just leave this line alone -->
"scripts": {
    "build": "NODE_ENV=production webpack --mode=production --progress",
    "build:dev": "NODE_ENV=development webpack --mode=development --progress",
} 
<!-- Just leave this line alone -->
    </code>
</pre>

            <h2>Setup Babel</h2>

            <p>We're going to setup a rule that checks for an <strong>.js</strong> file in the project (not including <strong>node_modules</strong>) and uses Babel to transpile our code. For this to work we need a few fewer dependencies installed:</p>

            <ul>
                <li><strong>babel-loader</strong> - transpile files with Babel and Webpack.</li>
                <li><strong>@babel/core</strong> - transpile ES2015 (ES6) and above to backwards compatible JavaScript. Useful for older browsers like IE.</li>
                <li><strong>@babel/preset-env</strong> - Smart defaults for Babel.</li>
            </ul>

            <p>As an example, add the following code into your index.js file and run your Webpack build:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
class Game {
    name = 'Violin Charades'
} 
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>Without Babel installed, we may get an error like the one below:</p>

<!-- Terminal -->
<div class="terminal terminal--shadow">
    <div class="terminal__top">
        <div class="terminal__buttons">
            <span class="terminal__circle terminal__circle--clear"></span>
            <span class="terminal__circle terminal__circle--clear"></span>
            <span class="terminal__circle terminal__circle--clear"></span>
        </div>
        <div class="terminal__title">Error</div>
    </div>
    <pre class="terminal__body terminal__body--error">
<!-- Just leave this line alone -->
    ERROR in ./src/index.js 4:6<br>
    Module parse failed: Unexpected token (4:6)<br>
    You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file.
    </pre>
</div>
<!-- / Terminal -->

            <p>Install Babel, and the additional dependencies, using NPM (Node Package Manager) as devDependencies.</p>

<!-- Terminal -->
<div class="terminal terminal--shadow">
    <div class="terminal__top">
        <div class="terminal__buttons">
            <span class="terminal__circle terminal__circle--red"></span>
            <span class="terminal__circle terminal__circle--yellow"></span>
            <span class="terminal__circle terminal__circle--green"></span>
        </div>
        <div class="terminal__title">bash -- 85x24</div>
    </div>
    <pre class="terminal__body">
<!-- Just leave this line alone -->
    $ npm install babel-loader @babel/core @babel/preset-env --save-dev
    </pre>
</div>
<!-- / Terminal -->

            <p>Once installed, update the <strong>webpack.config.js</strong> file:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
const env = process.env.NODE_ENV
const path = require('path')

module.exports = {
    entry: {
        main: path.resolve(__dirname, './src/index.js')
    },
    module: {
        rules: [
            // JavaScript
            {
                test: /\.js$/,
                exclude: /node_modules/,
                use: ['babel-loader']
            }
        ]
    },
    output: {
        path: path.resolve(__dirname, './dist'),
        filename: env === 'production' ? '[name].bundle.min.js' : '[name].bundle.js'
    }
}
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>Create a <strong>.babelrc</strong> file in the root of your project. This will add a lot of defaults with <strong>preset-env</strong> and any additional plugins you may want to use for Babel.</p>

<pre>
    <code>
<!-- Just leave this line alone -->
{
    "presets": ["@babel/preset-env"]
}
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>Your file structure should now look something like this:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
node_modules
.babelrc
dist /
    main.js
.gitignore
package-lock.json
package.json
src /
    index.js
webpack.config.js
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>This will still throw an error as we are attempting to parse a ES6 class. To fix this issue, install the <strong>@babel/plugin-proposal-class-properties</strong> package and update the <strong>.babelrc</strong> config file.</p>

<!-- Terminal -->
<div class="terminal terminal--shadow">
    <div class="terminal__top">
        <div class="terminal__buttons">
            <span class="terminal__circle terminal__circle--red"></span>
            <span class="terminal__circle terminal__circle--yellow"></span>
            <span class="terminal__circle terminal__circle--green"></span>
        </div>
        <div class="terminal__title">bash -- 85x24</div>
    </div>
    <pre class="terminal__body">
<!-- Just leave this line alone -->
    $ npm install @babel/plugin-proposal-class-properties --save-dev
    </pre>
</div>
<!-- / Terminal -->

            <p>Your <strong>.babelrc</strong> config file should now look like this:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
{
    "presets": ["@babel/preset-env"],
    "plugins": ["@babel/plugin-proposal-class-properties"]
}
<!-- Just leave this line alone -->
    </code>
</pre>
    
            <p>Should you want to setup Webpack with Babel for a React project, this has been documented within the <a href="getting-started-with-react.html">React setup guide</a>.</p>

            <h2>Adding Styles</h2>

            <p>Using a style loader is necessary to be able to import a CSS or stylesheet into your scripts. In some instances, developers are using <strong>CSS-in-JSS</strong> styled components and new tools to bring styles into their JavaScript apps.</p>

            <p>To keep it simple, we want to use <strong>PostCSS</strong> which will allow us to use the latest CSS features in any browser and we want to consider the use of <strong>Sass/SCSS</strong> as a CSS preprocessor.</p>

            <p>Here are some of the packages we may look to install as devDependencies:</p>

            <ul>
                <li><strong>sass-loader</strong> - load SCSS and compile into CSS</li>
                <li><strong>node-sass</strong> - Node Sass</li>
                <li><strong>postcss-loader</strong> - Process CSS with PostCSS</li>
                <li><strong>postcss-preset-evn</strong> - Sensible defaults for PostCSS</li>
                <li><strong>css-loader</strong> - Resolve CSS imports</li>
                <li><strong>style-loader</strong> - Inject CSS into the DOM (Document Object Model)</li>
            </ul>

            <p>Just like with Babel, we will need to first install these packages:</p>

<!-- Terminal -->
<div class="terminal terminal--shadow">
    <div class="terminal__top">
        <div class="terminal__buttons">
            <span class="terminal__circle terminal__circle--red"></span>
            <span class="terminal__circle terminal__circle--yellow"></span>
            <span class="terminal__circle terminal__circle--green"></span>
        </div>
        <div class="terminal__title">bash -- 85x24</div>
    </div>
    <pre class="terminal__body">
<!-- Just leave this line alone -->
    $ npm install sass-loader postcss-loader css-loader style-loader postcss-preset-env node-sass --save-dev
    </pre>
</div>
<!-- / Terminal -->

            <p>In the root of your project create a PostCSS config file named <strong>postcss.config.js</strong> and add the following code:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
module.exports = {
    plugins: {
        'postcss-preset-env': {
        browsers: 'last 2 versions',
        },
    }
}
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>In your <strong>src</strong> directory, create a new folder named <strong>styles</strong> and add a <strong>main.scss</strong> file containing the following code:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
$font-size: 1rem;

html {
    font-size: $font-size;
}
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>Update the <strong>index.js</strong> file to import the SCSS file into your bundle. This will allow Webpack to locate your styling.</p>

<pre>
    <code>
<!-- Just leave this line alone -->
import './src/styles/main.scss'
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>Your file directory should look something like this (the order may differ slightly):</p>

<pre>
    <code>
<!-- Just leave this line alone -->
node_modules
dist /
    main.bundle.js
    main.bundle.min.js
src /
    styles /
        main.scss
    index.js
.gitignore
package-lock.json
package.json
.babelrc
postcss.config.js
webpack.config.js
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>Open the webpack.config.js file and update your code to add the four loaders. They compile from last to first, so the last one you'll want in the list is the sass-loader as that needs to compile the SCSS, then PostCSS, then CSS and finally style-loader which will inject the CSS into the DOM.</p>

<pre>
    <code>
<!-- Just leave this line alone -->
const env = process.env.NODE_ENV
const path = require('path')

module.exports = {
    entry: {
        main: path.resolve(__dirname, './src/index.js')
    },
    module: {
        rules: [
            // JavaScript
            {
                test: /\.js$/,
                exclude: /node_modules/,
                use: ['babel-loader']
            },
            // SCSS/CSS
            {
                test: /\.(scss|css)$/,
                use: ['style-loader', 'css-loader', 'postcss-loader', 'sass-loader']
            }
        ]
    },
    output: {
        path: path.resolve(__dirname, './dist'),
        filename: env === 'production' ? '[name].bundle.min.js' : '[name].bundle.js'
    }
}
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>When you run the build, the SCSS will compile into CSS but you will not see a CSS stylesheet being created. The styling is injected into the DOM via the main.js file.</p>

            <p>To compile the SCSS into a CSS stylesheet that is exported, we need to use the MiniCssExtractPlugin instead. Begin by installing this plugin as a devDependency using NPM (Node Package Manager).</p>

<!-- Terminal -->
<div class="terminal terminal--shadow">
    <div class="terminal__top">
        <div class="terminal__buttons">
            <span class="terminal__circle terminal__circle--red"></span>
            <span class="terminal__circle terminal__circle--yellow"></span>
            <span class="terminal__circle terminal__circle--green"></span>
        </div>
        <div class="terminal__title">bash -- 85x24</div>
    </div>
    <pre class="terminal__body">
<!-- Just leave this line alone -->
    $ npm install mini-css-extract-plugin --save-dev
    </pre>
</div>
<!-- / Terminal -->

            <p>Update your webpack.config.js file to look like the code below:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
const env = process.env.NODE_ENV
const path = require('path')
const MiniCssExtractPlugin = require('mini-css-extract-plugin')

module.exports = {
    entry: {
        main: path.resolve(__dirname, './src/index.js')
    },
    module: {
        rules: [
            // JavaScript
            {
                test: /\.js$/,
                exclude: /node_modules/,
                use: ['babel-loader']
            },
            // SCSS/CSS
            {
                test: /\.(scss|css)$/,
                use: [
                    MiniCssExtractPlugin.loader,
                    {
                        loader: 'css-loader',
                        options: {
                            importLoaders: 2,
                            sourceMap: false,
                        },
                    },
                    'postcss-loader',
                    'sass-loader',
                ]
            }
        ]
    },
    plugins: [
        // Extracts CSS into separate files
        new MiniCssExtractPlugin({
            filename: 'styles/[name].[contenthash].css',
            chunkFilename: '[id].css',
        })
    ],
    output: {
        path: path.resolve(__dirname, './dist'),
        filename: env === 'production' ? '[name].bundle.min.js' : '[name].bundle.js'
    }
}
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>Now when you run the build, a CSS stylsheet called main.css inside a styles directory within dist will be generated. You will notice that both the minified and un-minified CSS stylesheets have a string after the filename. This is caused by the contenthash and will randomly generate on each build if the stylesheet code changes to help with cache busting.</p>

            <p>You will need to setup the HtmlWebpackPlugin to apply cache busting to your HTML code for this to work.</p>

            <p>Your file structure should now look like this:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
node_modules
dist /
    styles/
        main.8bifb9933023023.css    // This will be randomly generated
    main.bundle.js
    main.bundle.min.js
src /
    styles /
        main.scss
    index.js
.gitignore
package-lock.json
package.json
.babelrc
postcss.config.js
webpack.config.js
<!-- Just leave this line alone -->
    </code>
</pre>

		</div>
	</div>
</main>

</body>
</html>