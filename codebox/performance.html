<!DOCTYPE html>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A guide to Performance">

	<title>Codebox - Performance</title>

	<link rel="shortcut icon" type="image/ico" href="favicon/code.ico">
	<link rel="stylesheet" href="style/foundation.min.css">
	<link rel="stylesheet" href="style/main.css">
</head>
<body>

<main role="main">
	<div class="row">
		<div class="columns small-12 large-12">

			<h1>Performance</h1>

            <h2>Performance Budget</h2>

            <p>Performance is an important part of the user experience. To reach the goal of great performance, you have to define this clearly. Setting a <strong>performance budget</strong> will help to do this. Defining a budget helps get web performance agreed before starting a project and serves as a point-of-reference for making decisions about design, technology and features.</p>

            <p>A performance budget is a set of limits imposed on metrics that affect site performance. This could be:</p>

            <ul>
                <li>The total size of the page.</li>
                <li>The time it takes to load on a mobile network.</li>
                <li>The number of HTTP requests.</li>
                <li>Maximum size of images.</li>
                <li>Maximum number of web fonts used.</li>
                <li>Maximum file size of scripts, including framworks and/or libraries.</li>
                <li>Total number of external resources, including third-party scripts.</li>
            </ul>

            <p>Examples of a performance budget:</p>

            <ul>
                <li>Our product page must ship less than <strong>170KB</strong> of JavaScript on mobile.</li>
                <li>Our search page must include less than <strong>2MB</strong> of images on desktop.</li>
                <li>Our homepage must load and get interactive in <strong>&lt; 5 seconds</strong> on a slow 3G mobile device.</li>
                <li>Our blog must score <strong>&gt; 80</strong> on Lighthouse performance audits.</li>
            </ul>

            <p>Tools like Lighthouse and WebPageTest calculate performance scores based on general best practice rules. These scores can be used as guidelines for <strong>rule-based metrics</strong> and can be added to a performance budget.</p>

            <p>A performance budget can be added to your build tools. There are a few open-source tools that can help you add a performance budget to your build process:</p>

            <ul>
                <li><a href="https://webpack.js.org/configuration/performance/" target="_blank" rel="noopener noreferrer">Webpack performance features</a></li>
                <li><a href="https://github.com/siddharthkp/bundlesize" target="_blank" rel="noopener noreferrer">Bundlesize</a></li>
                <li><a href="https://web.dev/use-lighthouse-for-performance-budgets/?utm_source=lighthouse&utm_medium=devtools" target="_blank" rel="noopener noreferrer">Use Lighthouse for performance budgets</a></li>
            </ul>

            <p>The tools will allows us to ensure our code adheres to the performance budget set. If something goes over the threshold:</p>

            <ul>
                <li>Optimise the existing feature or asset.</li>
                <li>Remove an existing feature or asset.</li>
                <li>Avoid adding the new feature or asset.</li>
            </ul>

            <h2>What is page speed?</h2>

            <p>Page speed is the speed of an individual page on your site. The page speed metric shows <strong>First Contentful Paint (FCP)</strong> as simulated in a lab environment and available from Google <a href="https://developers.google.com/speed/pagespeed/insights/" target="_blank" rel="noopener noreferrer">PageSpeed Insights (PSI)</a>. FCP marks the first point in the page load timeline where the user can see anything on the screen - a fast FCP helps reassure the user that something is happening.</p>

            <p>If a page loads slowly the user will wait longer to see something useful and perceive the page as slower.</p>

            <p>Milestone timings mark events that happen during the page load. The most useful timings are <strong>user-centric performance metrics</strong> that tell you something about the experience of loading a page. These metrics are available through browser APIs and as part of Lighthouse reports.</p>

            <ul>
                <li><strong>First Contentful Paint (FCP)</strong> - measures when the browser displays the first bit of content from the <abbr title="Document Object Model">DOM</abbr>, like text or images. Anything inside of an iframe is not included.</li>
                <li><strong>Time to Interactive (TTI)</strong> - measures how long it takes for the page to become fully interactive and reliably respond to user input. This is a very important metric to track user interaction on the page, like clicking links, buttons or using form elements.</li>
            </ul>

            <p><strong>First Contentful Paint (FCP)</strong> is one of six metrics tracked in the Performance section of a Lighthouse report. Each metric captures some aspect of page load speed.</p>

            <p>Your FCP score is a comparison of your page's FCP time and FCP times for real websites, based on data from the <strong>HTTP archive</strong>. Sites performing in the ninety-ninth percentile render FCP in around 1.5 seconds, if your website's FCP is 1.5 seconds, your FCP score is 99.</p>

            <h2>Tools & Resources to monitor performance</h2>

            <p>There are a number of tools available to monitor performance of your website, web page or application:</p>

            <ul>
                <li><a href="https://web.dev/" target="_blank" rel="noopener noreferrer">web.dev</a>
                <li><a href="https://web.dev/measure/" target="_blank" rel="noopener noreferrer">web.dev Measure tool</a>
                <li><a href="https://developers.google.com/web/tools/lighthouse/" target="_blank" rel="noopener noreferrer">Google Lighthouse</a></li>
                <li><a href="https://www.thinkwithgoogle.com/feature/testmysite/" target="_blank" rel="noopener noreferrer">Google: Test my site</a></li>
                <li><a href="https://developers.google.com/speed/pagespeed/insights/" target="_blank" rel="noopener noreferrer">Google PageSpeed Insights (PCI)</a></li>
                <li><a href="https://www.webpagetest.org/" target="_blank" rel="noopener noreferrer">WebPageTest.org</a></li>
                <li><a href="https://nibbler.silktide.com/" target="_blank" rel="noopener noreferrer">Nibbler</a></li>
                <li><a href="https://caniuse.com/" target="_blank" rel="noopener noreferrer">Caniuse</a></li>
            </ul>

            <h2>Benchmarking</h2>

            <p>To benchmark performance, you first need to establish a <strong>baseline</strong>. Analyze the competition to see how you stack up. Here are examples of good default numbers to get you started:</p>

            <ul>
                <li><strong>Time to Interactive (TTI)</strong> is <strong>under 5 seconds</strong>.</li>
                <li>Under <strong>170KB</strong> of critical-path resources (compressed/minified).</li>
            </ul>

            <p>These numbers are calculated based on real-world basedline devices and <strong>3G network speeds</strong>.</p>

            <p>When performance tools are used, it's time to record values. These benchmarks will provide a useful comparison as you optimise your page. If the metrics improve, your changes are worthwhile, if they remain static (or worse, decline), you'll need to rethink your strategy. It's worthwhile running the tools a few times to take a median/average value for each.</p>

            <h2>Render Blocking</h2>

            <p>CSS files are <strong>render-blocking resources</strong>, they mist be loaded and processed before the browser renders the page. Web pages that contain unnecessarily large styles take longer to render.</p>

            <p>To defer non-critical CSS will lead to the goal of optimising the <strong>Critical Rendering Path</strong> and improving <strong>First Contentful Paint (FCP)</strong>.</p>

            <h2>Remove unused CSS</h2>

            <p>If Lighthouse detects that a page has at least <strong>2048 bytes</strong> of CSS rules that weren't used while rendering the above the fold content, you'll receive a suggestion in the performance audit called <strong>Remove Unused CSS</strong>.</p>

            <p>The Opportunities section of your Lighthouse report lists all stylesheets with unused CSS with a potential saving of <strong>2KB or more</strong>. Remove the unused CSS to reduce unnecessary bytes consumed by network activity.</p>

            <p>Using a <strong>&lt;link&gt;</strong> tag is a common way to add styles to a page.</p>

<pre>
    <code>
<!-- Just leave this line alone -->
&lt;link rel="stylesheet" href="styles.css"&gt;
<!-- Just leave this line alone -->
    </code>
</pre>  

            <p>The <strong>styles.css</strong> file that the browser downloads is known as an <strong>external stylesheet</strong> because it's stored separately from the HTML that uses it. By default, a browser must download, parse and process all external stylesheets that it encounters before it can display, or render, any content to the screen. This is because the stylesheet may contain rules that affect the styling of the page.</p>

            <p>Each external stylesheet must be downloaded from the network. These extra network trips can increase the time that users must wait before they see any content on the screen.</p>

            <p>Unused CSS slows down the browser's construction of the <strong>render tree</strong>. The render tree is similar to the DOM tree except that it includes the styles for each node. The browser must walk the entire DOM tree and check which CSS rules apply to each node. The more unused CSS there is, the more time the browser might potentially need to spend time calculating the styles for each node.</p>

            <p>The <strong>Coverage tab</strong> in the <strong>Chrome Developer Tools (DevTools)</strong> can help you to discover <strong>critical</strong> and <strong>uncritical</strong> CSS. We can then inline critical CSS inside the <strong>&lt;head&gt;</strong> section of the HTML page using the <strong>&lt;style&gt;</strong> block and load the rest of the styles <strong>asynchronously</strong> using the <strong>preload</strong> link.</p>

            <p>This process can be automated using the <a href="https://github.com/addyosmani/critical/blob/master/README.md" target="_blank" rel="noopener noreferrer">Critical tool</a> that will extract and incline "Above the Fold" CSS.</p>

            <h2>Code Coverage (Chrome)</h2>

            <p><strong>Chrome Developer Tools</strong> has a tool that helps assess thee bloat in files. The <a href="https://developers.google.com/web/updates/2017/04/devtools-release-notes#coverage" target="_blank" rel="noopener noreferrer">Coverage tab</a> analyses code coverage as you navigate your website and provides a report/interface showing how much code in a given CSS or JavaScript file is actually being used.</p>

            <p>To access the Coverage tab in Chrome:</p>

            <ul>
                <li>Open the <strong>Chrome Developer Tools</strong>.</li>
                <li>Click on the three dots in the top right.</li>
                <li>Navigate to <strong>More Tools</strong> &gt; <strong>Coverage</strong>.</li>
                <li>Click the reload button to reload the page and begin the code coverage analysis.</li>
            </ul>

            <p>The report will show the amount of code being <strong>unused in red</strong>, <strong>green indicates the code being used</strong>. This only represents the current render and this will change as you change your screen size or interact with elements like modals or toggles.</p>

            <h2>Minify Files</h2>

            <p>Every unnecessary piece of code adds to the size of your page. It's important to minimise files where possible to eliminate extra spaces, line breaks and indentation. This ensures that your pages are as lean as possible.</p>

            <ul>
                <li>minify.min.js</li>
                <li>style.min.css</li>
            </ul>

            <p>Minification reduces the file size to reduce the size of your requests.</p>

            <h2>Reduce HTTP Requests</h2>

            <p>If you use Chrome, you can use the <strong>Chrome Developer Tools</strong> to see how many HTTP requests the site makes.</p>

            <ul>
                <li>Open the <strong>Chrome Developer Tools</strong>.</li>
                <li>Click on the <strong>Network</strong> tab.</li>
                <li>In the bottom left corder you'll see the number of total requests the site makes. Reducing the number of requests will improve the speed of the site.</li>
            </ul>

            <p>Reducing the number of CSS and JavaScript files can help to reduce the number of requests the website makes everytime a user visits.</p>

            <h2>Preload</h2>

            <p>The preload value of a <strong>&lt;link&gt;</strong> element's <strong>rel</strong> attribute lets you declare fetch requests in the <strong>&lt;head&gt;</strong> section of your HTML document. This ensures the resources are available earlier and are less likely to block the page render, improving performance.</p>

            <p>Within your Lighthouse audit, you may encounter the following notification:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
Consider using '&lt;link rel="preload"&gt;' to prioritize fetching resources that are currently requested later in page load.
<!-- Just leave this line alone -->
    </code>
</pre>

            <p>Suppose your page's <strong>critical request chain</strong> looks like this:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
index.html /
    app.js /
        styles.css
        ui.js
<!-- Just leave this line alone -->
    </code>
</pre>     

            <p>Your <strong>index.html</strong> file declares <strong>&lt;script src="app.js"&gt;</strong>. When <strong>app.js</strong> runs, it calls <strong>fetch()</strong> in order to download <strong>styles.css</strong> and <strong>ui.js</strong>. The page doesn't appear complete until the last two resource are downloaded, parsed and executed. Using this example, Lighthouse would flag styles.css and ui.js as candidates.</p>

            <p>If, for example, app.js takes <strong>200ms</strong> to download, parse and execute, the potential savings for each resource is 200ms since app.js is no longer a bottleneck for each of the requests.</p>

            <p>Here's an example of how to add preloading to your HTML page:</p>

<pre>
    <code>
<!-- Just leave this line alone -->
&lt;head&gt;
    &lt;link rel="preload" href="styles.css" as="style"&gt;
    &lt;link rel="preload" href="ui.js" as="script"&gt;
    &lt;link rel="preload" href="font.woff2" as="font" type="font/woff2" crossorigin="anonymous"&gt;

    &lt;!-- Stylesheets here --&gt;
    &lt;link rel="stylesheet" href="styles.css"&gt;
&lt;/head&gt;
<!-- Just leave this line alone -->
    </code>
</pre>   

            <p>This example is trivial as the browser probably discovers the CSS stylesheet in the same chunk of HTML as the preloads, but the benefits can be seen much more clearly the later resources are discovered and the larger they are, for example:</p>

            <ul>
                <li>Resources that are pointed to from inside CSS, like fonts or images.</li>
                <li>Resources that JavaScript can request, like JSON, imported scripts or web workers.</li>
                <li>Larger images or video files.</li>
            </ul>

            <p>Preloading requests can make your pages load faster. Without preload links, styles.css and ui.js are requested only after app.js has been downloaded, parsed and executed. Before using preload, the files would be requested like so:</p> 

            <ul>
                <li>app.js</li>
                <li>styles.css</li>
                <li>ui.js</li>
            </ul>

            <p>The browser only becomes aware of those last two resources after it downloads, parses and executes app.js, but both styles.css and ui.js are important resources and should be downloaded as soon as possible. With preload enabled, the files will be requested like so (see the <strong>Network tab</strong> in the <strong>Chrome Developer Tools</strong>):</p>

            <ul>
                <li>ui.js</li>
                <li>styles.css</li>
                <li>app.js</li>
            </ul>

            <p>With preload links, <strong>styles.css</strong> and <strong>ui.js</strong> are requested at the same time as <strong>app.js</strong>.</p>

            <p>Preload is supported by a number of browsers, including <strong>Chrome</strong>, <strong>Edge</strong> and <strong>Safari</strong>, however <strong>Firefox</strong> and <strong>IE</strong> have no native support for preload currently (November 2020) according to <a href="https://caniuse.com/?search=preload" target="_blank" rel="noopener noreferrer">caniuse</a>.</p>

            <h2>Useful Resources & Links</h2>

            <ul>
                <li><a href="https://web.dev/defer-non-critical-css/" target="_blank" rel="noopener noreferrer">web.dev: Defer non-critical CSS</a></li>
                <li><a href="https://web.dev/unused-css-rules/?utm_source=lighthouse&utm_medium=devtools" target="_blank" rel="noopener noreferrer">web.dev: Remove unused CSS</a>
            </ul>

		</div>
	</div>
</main>

</body>
</html>