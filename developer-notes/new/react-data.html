<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Developer Notes - React: Data</title>

    <link rel="shortcut icon" type="image/ico" href="img/favicon/code.ico" />
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="preload" href="fonts/nunito-v9-latin-regular.woff2" as="font" type="font/woff2" crossorigin />
</head>
<body>

<header class="header" role="banner">
    <nav class="header__inner">
        <ul class="header__item header__item--links">
            <li class="header__link">
                <span class="header__link--background">
                    <a href="index.html">Home</a>
                </span>
            </li>
            <li class="header__link">
                <span class="header__link--background">
                    <a href="#main">Skip to content</a>
                </span>
            </li>
        </ul>
    </nav>
</header>

<main role="main" id="main">
    <h1>React: Data</h1>

    <p>Most modern web applications make use of the <a href="https://searchapparchitecture.techtarget.com/definition/REST-REpresentational-State-Transfer" target="_blank" rel="noopener noreferrer">REST</a> Protocol to communicate with each other. To achieve this, data is sent as JSON (JavaScript Object Notation) to the <abbr title="Application Programming Interface">API</abbr>. In turn, the API returns a JSON payload which can be static or dynamic data.</p>

    <div class="note">
        <p>When fetching data in React, the componentDidMount() lifecycle method is the best place to fetch data.</p>
    </div>

    <p>Here are a few useful APIs:</p>

    <ul>
        <li><a href="http://jsonplaceholder.typicode.com/users" target="_blank" rel="noopener noreferrer">http://jsonplaceholder.typicode.com/users</a></li>
        <li><a href="https://api.github.com" target="_blank" rel="noopener noreferrer">https://api.github.com</a></li>
        <li><a href=" https://ghibliapi.herokuapp.com/films" target="_blank" rel="noopener noreferrer">https://ghibliapi.herokuapp.com/films</a></li>
    </ul>

    <h2>Create a simple component</h2>

    <p>We're going to be using the ES6 arrow function to create simple components. First, a table header.</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React from 'react'

const TableHeader = () => {
    return (
        &lt;thead&gt;
            &lt;tr&gt;
                &lt;th&gt;Name&lt;/th&gt;
                &lt;th&gt;Job&lt;/th&gt;
            &lt;/tr&gt;
        &lt;/thead&gt;
    )
}

export default TableHeader
        </code>
    </pre>

    <p>The table body can then be created.</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React from 'react'

const TableBody = () => {
    return (
        &lt;tbody&gt;
            &lt;tr&gt;
                &lt;td&gt;Charlie&lt;/td&gt;
                &lt;td&gt;Janitor&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;Mac&lt;/td&gt;
                &lt;td&gt;Bouncer&lt;/td&gt;
            &lt;/tr&gt;
            &lt;tr&gt;
                &lt;td&gt;Dee&lt;/td&gt;
                &lt;td&gt;Actress&lt;/td&gt;
            &lt;/tr&gt;
        &lt;/tbody&gt;
    )
}

export default TableBody
        </code>
    </pre>

    <p>A class component is created that will render our table.</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React, { Component } from 'react'

import TableHeader from './TableHeader'
import TableBody from './TableBody'

class Table extends Component {
    render() {
        return(
            &lt;table&gt;
                &lt;TableHeader /&gt;
                &lt;TableBody /&gt;
            &lt;/table&gt;
        )
    }
}

export default Table
        </code>
    </pre>

    <p>Here is the code for the index.js file also:</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React from 'react';
import { render } from 'react-dom';

import App from './App'

render(
    &lt;App /&gt;,
    document.getElementById('app')
);
        </code>
    </pre>

    <p>The App.js code can be found further down this document.</p>

    <p>Your file structure should look something like this:</p>

    <pre>
        <code>
<!-- leave this line empty -->
.babelrc
node_modules/
webpack.config.js
package.json
package-lock.json
dist/
    index.html
    main.js
src/
    index.js
    App.js
    Table.js
    TableBody.js
    TableHeader.js
        </code>
    </pre>

    <p>Right now we have a Table component, but the data is being hard-coded. One of the main benefits of using React is how it handles data, it does so with properties - referred to as props - and with state.</p>

    <p>Let's now remove all the data from our TableBody component.</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React from 'react'

const TableBody = () => {
    return &lt;tbody /&gt;
}

export default TableBody
        </code>
    </pre>

    <p>All our data can now be moved to an array of objects, as if we were bringing in a JSON-based API. We will have to create this array inside our render() method.</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React, { Component } from 'react'

import Table from './Table'

class App extends Component {
    render() {
        const characters = [
        {
            name: 'Charlie',
            job: 'Janitor',
        },
        {
            name: 'Mac',
            job: 'Bouncer',
        },
        {
            name: 'Dee',
            job: 'Actress',
        },
    ]

    return (
        &lt;div className="container"&gt;
            &lt;Table /&gt;
        &lt;/div&gt;
    )
  }
}

export default App
        </code>
    </pre>

    <p>Now we're going to pass the data through to the child component of Table using props (properties). We can call the property whatever we want as long as it's not a reserved keyword. In our example, the prop is called characterData. The data being passed through is the characters variable. This is placed between curly braces as it's a JavaScript expression.</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React, { Component } from 'react'

import Table from './Table'

class App extends Component {
    render() {
        const characters = [
        {
            name: 'Charlie',
            job: 'Janitor',
        },
        {
            name: 'Mac',
            job: 'Bouncer',
        },
        {
            name: 'Dee',
            job: 'Actress',
        },
    ]

    return (
        &lt;div className="container"&gt;
            &lt;Table characterData={characters} /&gt;
        &lt;/div&gt;
    )
  }
}

export default App
        </code>
    </pre>

    <p>Now that the data is being passed through to our Table component, we have to work on accessing it from the other side.</p>

    <p>We are going to use the ES6 property shorthand to create a variable that contains this.props.characterData</p>

    <pre>
        <code>
<!-- leave this line empty -->
const { characterData } = this.props
        </code>
    </pre> 

    <p>Here is the full code example for our Table component:</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React, { Component } from 'react'

import TableHeader from './TableHeader'
import TableBody from './TableBody'

class Table extends Component {
    render() {

        const { characterData } = this.props

        return(
            &lt;table&gt;
                &lt;TableHeader /&gt;
                &lt;TableBody characterData={characterData} /&gt;
            &lt;/table&gt;
        )
    }
}

export default Table
        </code>
    </pre>

    <p>This data is not in the actual DOM yet, however we can access all props through this.props, at this stage we are only passing one prop through, characterData, so we'll use this.props.characterData to retrieve that data.</p>

    <div class="note">
        <p>If you open React DevTools and inspect the Table component, you'll see the array of data in the property. The data that's stored here is known as the virtual DOM, which is a fast and efficient way of syncing data with the actual DOM.</p>
    </div> 

    <p>We are now going to pass the props through as a parameter and map through the array to return a bale row for each object in the array. This map will be contained in the rows variable which we return as an expression.</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React from 'react'

const TableBody = props =&gt; {

    const rows = props.characterData.map((row, index) =&gt; {
        return(
            &lt;tr key={index}&gt;
                &lt;td&gt;{row.name}&lt;/td&gt;
                &lt;td&gt;{row.job}&lt;/td&gt;
            &lt;/tr&gt;
        )
    })

    return &lt;tbody&gt;{rows}&lt;/tbody&gt;
}

export default TableBody
        </code>
    </pre>

    <p>If you view the front end of the app, all the data is now loading. You may notice that a key index has been added to each table row. You should always use keys when making lists in React as they help to identify each list item.</p>

    <p>Props are an effective way to pass existing data to a React component, however, the component cannot change the props as they're read-only.</p>

    <div class="note">
        <p>Don't forget to rebuild you application using Webpack whenever you make changes to your React code.</p>
    </div>

    <h3>Further example</h3>

    <p>Here is a further example to demonstrate how to render JSON data within an application. Update the index.js file with the following example:</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React from 'react'
import { render } from 'react-dom'

// Data
const data = [
    {
        "ingredients": [
            {
                "name": "Salmon"
            },
            {
                "name": "Butter Lettuce"
            }
        ]
    }
]

// Menu Component
const Menu = ({ recipes }) =&gt;
    &lt;React.Fragment&gt;
        {recipes.map((recipe, i) =&gt;
            &lt;Recipe key={i} {...recipe} /&gt;
        )}
    &lt;/React.Fragment&gt;

// Recipe Component
const Recipe = ({ ingredients, name }) =&gt;
    &lt;React.Fragment&gt;
        &lt;ul&gt;
            {ingredients.map((ingredient, i) =&gt; 
                &lt;li key={i}&gt;{ingredient.name}&lt;/li&gt;
            )}
        &lt;/ul&gt;
    &lt;/React.Fragment&gt;

render(
    &lt;Menu recipes={data} /&gt;,
    document.getElementById('app')
)
        </code>
    </pre>

    <h2>State</h2>

    <p>Currently we're storing our character data in an array within a variable and passing it through as props. This is a good start, however we may want to have the option to delete an item from the array. With props, we have a one way data flow, but with state, we can update private data from a component.</p>

    <div class="note">
        <p>You can think of state as any data that should be saved or modified without necessarily being added to a database - for example, adding and removing items from a shopping cart before confirming your purchase.
    </div>

    <p>To begin, we're going to create a state object within the App component.</p>

    <pre>
        <code>
<!-- leave this line empty -->
class App extends Component {
    state = {}
}
        </code>
    </pre>  

    <p>The object will contain properties for everything you want to store in the state. For us, it's characters.</p>

    <pre>
        <code>
<!-- leave this line empty -->
class App extends Component {
    state = {
        characters: [],
    }
}
        </code>
    </pre> 

    <p>Move the entire array of objects we created earlier into state.characters</p>

    <pre>
        <code>
<!-- leave this line empty -->
class App extends Component {
    state = {
        characters: [
            {
                name: 'Charlie',
                // The rest of the data goes here
            },
        ],
    }
}
        </code>
    </pre> 

    <p>Our data is officially contained in the state. Since we want to be able to remove a character from the tabel, we're going to create a removeCharacter method on the parent App class.</p>

    <p>To retrieve the state, we'll get this.state.characters using the same ES6 method as before. To update the state, we'll use this.setState(), a built-in method for manipulating state. We will filter the array based on an index that we can pass through and return the new array.</p>

    <div class="note">
        <p>You must use this.setState() to modify an array. Simply applying a new value to this.state.property will not work.</p>
    </div>

    <pre>
        <code>
<!-- leave this line empty -->
// App.js

removeCharacter = index => {
    const { characters } = this.state

    this.setState({
        characters: characters.filter((character, i) => {
            return i !== index
        }),
    })
}
        </code>
    </pre> 

    <p>filter does no mutate but rather creates a new array and is a preferred method for modifying arrays in JavaScript. This particular method is testing an index against all the indices in the array and returning all but the one that is passed through.</p>

    <p>Now we have to pass the function through to the component and render a button next to each character that can invoke the function. We will pass the removeCharacter function through as a prop to the Table component.</p>

    <pre>
        <code>
<!-- leave this line empty -->
// App.js

render() {
    const { characters } = this.state

    return (
        &lt;div className="container"&gt;
            &lt;Table characterData={characters} removeCharacter={this.removeCharacter} /&gt;
        &lt;/div&gt;
    )
}
        </code>
    </pre> 

    <p>Here is the full App.js code:</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React, { Component } from 'react'

import Table from './Table'

class App extends Component {
    state = {
        characters: [
            {
                name: 'Charlie',
                job: 'Janitor'
            },
            {
                name: 'Mac',
                job: 'Bouncer'
            },
            {
                name: 'Dee',
                job: 'Actress'
            }            
        ],
    };

    // Method - remove character
    removeCharacter = index => {
        const { characters } = this.state

        this.setState({
            characters: characters.filter((character, i) => {
                return i !== index
            }),
        })
    };

    render() {
        const { characters } = this.state

        return (
            &lt;div className="container"&gt;
                &lt;Table characterData={characters} removeCharacter={this.removeCharacter} /&gt;
            &lt;/div&gt;
        )
    }
}

export default App
        </code>
    </pre>

    <p>Since we're passing it down to TableBody from Table, we're going to have to pass it through again as a prop, just like we did with the character data.</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React, { Component } from 'react'

import TableHeader from './TableHeader'
import TableBody from './TableBody'

class Table extends Component {
    render() {

        const { characterData, removeCharacter } = this.props

        return(
            &lt;table&gt;
                &lt;TableHeader /&gt;
                &lt;TableBody characterData={characterData} removeCharacter={removeCharacter} /&gt;
            &lt;/table&gt;
        )
    }
}

export default Table
        </code>
    </pre>

    <p>Here's where the index we defined in the removeCharacter() method comnes in. In the TableBody component, we'll pass the key/index through as a parameter so the filter function knows which item to remove. We will create a button with an onClick and pass it through.</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React from 'react'

const TableBody = props =&gt; {

    const rows = props.characterData.map((row, index) =&gt; {
        return(
            &lt;tr key={index}&gt;
                &lt;td&gt;{row.name}&lt;/td&gt;
                &lt;td&gt;{row.job}&lt;/td&gt;
                &lt;td&gt;
                    &lt;button onClick={() => props.removeCharacter(index)}&gt;Delete&lt;/button&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        )
    })

    return &lt;tbody&gt;{rows}&lt;/tbody&gt;
}

export default TableBody
        </code>
    </pre>

    <div class="note">
        <p>The onClick function must pass through a function that returns the removeCharacter() method, otherwise it will try and run automatically.</p>
    </div>

    <p>We should now have delete buttons we can use to modify our state by deleting a character.</p>

    <div class="note">
        <p>You may notice an error in your terminal when running the build: Support for the experimental syntax 'classProperties' isn't currently enabled</p>
    </div>

    <h3>Fixing the terminal issue</h3>

    <p>As described above, we have an issue in the terminal that we need to fix. Begin by installing a package using NPM (Node Package Manager). This should be installed as a devDependency.</p>

    <pre>
        <code>
<!-- leave this line empty -->
$ npm install @babel/plugin-proposal-class-properties --save-dev
        </code>
    </pre>

    <p>Next, update the .babelrc config file to apply the @babel/plugin-proposal-class-properties package.</p>

    <pre>
        <code>
<!-- leave this line empty -->
{
    "presets": [ 
        "@babel/preset-env",
        "@babel/preset-react" 
    ],
    "plugins": [
        "@babel/plugin-proposal-class-properties"
    ]
}
        </code>
    </pre>

    <p>Here is the link to the fix as an issue raised on GitHub: <a href="https://github.com/babel/babel/issues/8655" target="_blank" rel="noopener noreferrer">https://github.com/babel/babel/issues/8655</a></p>

    <h2>Adding the Button component</h2>

    <p>We can reuse our Button component we created previously and render this within the application. Begin by updating your Button component to add a new prop named onClick to the Button.js file.</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React from 'react'
import classNames from 'classnames'

const Button = ({ type = 'button', url = '', className = '', theme = '', isFullWidth = false, onClick, children }) => {

    const buttonClass = classNames('btn', className, {
        'btn--primary' : theme === 'primary',
        'btn--secondary' : theme === 'secondary',
        'btn--full-width' : isFullWidth
    })

    const isAnchor = url && (url.includes('http') || url.startsWith('#') || url.startsWith('mailto') || url.startsWith('/'))

    const renderAnchor = () =>
        &lt;a href={url} className={buttonClass}&gt;{children}&lt;/a&gt;

    const renderButton = () => 
        &lt;button type={type} className={buttonClass} onClick={onClick}&gt;{children}&lt;/button&gt;

    return (
        isAnchor ? renderAnchor() : renderButton()
    )
}

export default Button
        </code>
    </pre>

    <p>Within the TableBody component, update the code to import the Button component and render this in-place of the previous hard-coded button we were using previously.</p>

    <pre>
        <code>
<!-- leave this line empty -->
import React from 'react'

import Button from './Button/Button'

const TableBody = props =&gt; {

    const rows = props.characterData.map((row, index) =&gt; {
        return(
            &lt;tr key={index}&gt;
                &lt;td&gt;{row.name}&lt;/td&gt;
                &lt;td&gt;{row.job}&lt;/td&gt;
                &lt;td&gt;
                    &lt;Button theme="primary" onClick={() =&gt; props.removeCharacter(index)}>Delete&lt;/Button&gt;
                &lt;/td&gt;
            &lt;/tr&gt;
        )
    })

    return &lt;tbody&gt;{rows}&lt;/tbody&gt;
}

export default TableBody
        </code>
    </pre>

    <p>We are now using our Button component within our application.</p>

    <p>Our file structure should currently look like this:</p>

    <pre>
        <code>
<!-- leave this line empty -->
.babelrc
node_modules/
webpack.config.js
package.json
package-lock.json
dist/
    index.html
    main.js
src/
    index.js
    App.js
    Button/
        Button.js
    Table.js
    TableBody.js
    TableHeader.js
        </code>
    </pre>

    <p>Ideally, you can update the file structure and place all the Table components within a separate directory. The import statement paths will need to be updated if you do this.</p>

    <pre>
        <code>
<!-- leave this line empty -->
.babelrc
node_modules/
webpack.config.js
package.json
package-lock.json
dist/
    index.html
    main.js
src/
    index.js
    App.js
    Button/
        Button.js
    Table/
        Table.js
        TableBody.js
        TableHeader.js
        </code>
    </pre>

    <h2>Useful Links</h2>

    <ul>
        <li><a href="https://pusher.com/tutorials/consume-restful-api-react" target="_blank" rel="noopener noreferrer">Consume Restful APIs with React</a></li>
        <li><a href="https://github.com/fisayoafolayan/consuming-restful-api-in-react/tree/master/src" target="_blank" rel="noopener noreferrer">Consume Restful APIs with React: GitHub repository</a></li>
        <li><a href="https://github.com/babel/babel/issues/8655" target="_blank" rel="noopener noreferrer">Babel: Support for experimental 'classProperties' syntax</a></li>
        <li><a href="https://www.robinwieruch.de/react-fetching-data" target="_blank" rel="noopener noreferrer">React: Fetching Data</a></li>
    </ul>
</main>

</body>
</html>